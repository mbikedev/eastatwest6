# Nginx configuration for optimal cache policies
# Add this to your nginx server block to fix the "efficient cache policy" audit

# Cache configuration for Restaurant Guru assets (the specific asset from audit)
location /assets/restaurant-guru/ {
    # 1 year cache for immutable Restaurant Guru badges
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Vary "Accept-Encoding";
    add_header X-Cache-Tag "restaurant-guru-immutable";
    add_header X-Performance-Optimized "cache-policy-updated";
    
    # Enable compression
    gzip_static on;
    brotli_static on;
}

# Cache configuration for SVG files (including star_red.svg)
location ~* \.svg$ {
    # 1 year cache for SVG files
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Vary "Accept-Encoding";
    add_header Content-Type "image/svg+xml";
    
    # Enable compression
    gzip_static on;
    brotli_static on;
}

# Next.js static assets with content hashes (immutable)
location /_next/static/ {
    # 1 year cache for versioned assets
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Vary "Accept-Encoding";
    
    # Enable compression
    gzip_static on;
    brotli_static on;
}

# Other static assets
location /assets/ {
    # 6 months cache for general assets
    expires 6M;
    add_header Cache-Control "public, max-age=15768000";
    add_header Vary "Accept-Encoding";
    
    # Enable compression
    gzip_static on;
    brotli_static on;
}

# Images and media files
location ~* \.(jpg|jpeg|png|gif|webp|avif|mp4|webm)$ {
    # 6 months cache for images
    expires 6M;
    add_header Cache-Control "public, max-age=15768000";
    add_header Vary "Accept-Encoding";
    
    # Enable compression for small images
    gzip_static on;
    brotli_static on;
}

# Font files
location ~* \.(woff|woff2|ttf|eot)$ {
    # 1 year cache for fonts (rarely change)
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Vary "Accept-Encoding";
    add_header Access-Control-Allow-Origin "*";
    
    # Enable compression
    gzip_static on;
    brotli_static on;
}

# PDF files
location ~* \.pdf$ {
    # 30 days cache for PDFs (might be updated)
    expires 30d;
    add_header Cache-Control "public, max-age=2592000";
    add_header Vary "Accept-Encoding";
    
    # Enable compression
    gzip_static on;
    brotli_static on;
}

# CSS and JS files
location ~* \.(css|js)$ {
    # Check if it's a versioned file (has hash)
    if ($uri ~ ".*\.[a-f0-9]{8,}.*\.(css|js)$") {
        # 1 year for versioned files
        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
    }
    if ($uri !~ ".*\.[a-f0-9]{8,}.*\.(css|js)$") {
        # 6 months for non-versioned files
        expires 6M;
        add_header Cache-Control "public, max-age=15768000";
    }
    
    add_header Vary "Accept-Encoding";
    
    # Enable compression
    gzip_static on;
    brotli_static on;
}

# Global compression settings (add to http or server block)
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/javascript
    text/xml
    text/json
    application/javascript
    application/json
    application/xml
    application/rss+xml
    application/atom+xml
    image/svg+xml;

# Brotli compression (if module available)
brotli on;
brotli_comp_level 6;
brotli_min_length 1024;
brotli_types
    text/plain
    text/css
    text/javascript
    text/xml
    text/json
    application/javascript
    application/json
    application/xml
    application/rss+xml
    application/atom+xml
    image/svg+xml;